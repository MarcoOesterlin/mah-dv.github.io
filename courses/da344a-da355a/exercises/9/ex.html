# coding: utf-8
# Author: <Maria Holmberg>

from bottle import route, run, template, request, redirect


@route("/")
def list_articles():
    ''' This is the home page, which shows a list of links to all articles
    in the wiki. This import and import the file static and shows the content. Returns index, the homepage.'''
    from os import listdir
    folder = listdir("static")
    return template("index", files = folder)


@route("/create")
def create_article():
    ''' This functions calls for the create template where user create a new article '''
    return template("create")


@route("/save", method="POST")
def save_article():
    ''' Shows a form which allows the user to write input for an article. This form should be sent via POST. '''
    content = request.forms.get("text")
    pagename = request.forms.get("pagename")
    text_file = open("static/" + pagename + ".txt", "w")
    text_file.write(content)
    text_file.close()
    redirect("/wiki/" + pagename)



@route("/wiki/<pagename>")
def show_article(pagename):
    ''' Displays a single article (loaded from a text file)'''
    from os import listdir
    folder = listdir("static")

    for page in folder:
        if pagename + ".txt" == page:
            newarticle = open("static/" + pagename + ".txt", "r")
            savearticle = newarticle.read().decode("utf-8-sig").encode("utf-8")
            newarticle.close()
            return template("wiki", header=pagename, content=savearticle)

@route("/edit/<pagename>")
def edit_article(pagename):
    ''' Shows a form which allows the user to correct input for an article.'''
    article = open("static/" + pagename + ".txt", "r")
    information = article.read()
    article.close()
    return template("edit", content = information, header = pagename)

@route("/saveedit/<pagename>", method="POST")
def edit_save(pagename):
    ''' Receives new contents from a form, and creates/updates a text file for that page.'''
    content = request.forms.get("text")
    text_file = open("static/" + pagename + ".txt", "w")
    text_file.write(content)
    text_file.close()
    redirect("/wiki/" + pagename)

   


run(host="localhost", port=8080, debug=True)
